const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./dumpTools-D8pWAxiB.js","./iframe-Dzwdsmzj.js","./create-runtime-stories-C658kcdY.js","./props-D_CwaEcb.js","./index-client-a4XWVA08.js","./index-D-8MO0q_.js","./index-BHYIh-Xd.js","./_commonjsHelpers-Cpj98o6Y.js"])))=>i.map(i=>d[i]);
import{y as N,S as B,V as f,i as k,C,z as x,D as V,O as S,G as H,J as U,w as v,k as G,s as W,K as Y,N as X,Q as $}from"./create-runtime-stories-C658kcdY.js";import{_ as q}from"./iframe-Dzwdsmzj.js";class w{constructor(e,t,s,r){this.name=e,this.worldAxisForNormal=t,this.worldAxisForFileX=s,this.worldAxisForFileY=r}}class D{static ConvertCubeMapTextureToSphericalPolynomial(e){var l;if(!e.isCube)return null;(l=e.getScene())==null||l.getEngine().flushFramebuffer();const t=e.getSize().width,s=e.readPixels(0,void 0,void 0,!1),r=e.readPixels(1,void 0,void 0,!1);let a,n;e.isRenderTarget?(a=e.readPixels(3,void 0,void 0,!1),n=e.readPixels(2,void 0,void 0,!1)):(a=e.readPixels(2,void 0,void 0,!1),n=e.readPixels(3,void 0,void 0,!1));const o=e.readPixels(4,void 0,void 0,!1),d=e.readPixels(5,void 0,void 0,!1),i=e.gammaSpace,h=5;let u=0;return(e.textureType==1||e.textureType==2)&&(u=1),new Promise(g=>{Promise.all([r,s,a,n,o,d]).then(([L,b,p,T,m,P])=>{const O={size:t,right:b,left:L,up:p,down:T,front:m,back:P,format:h,type:u,gammaSpace:i};g(this.ConvertCubeMapToSphericalPolynomial(O))})})}static _AreaElement(e,t){return Math.atan2(e*t,Math.sqrt(e*e+t*t+1))}static ConvertCubeMapToSphericalPolynomial(e){const t=new N;let s=0;const r=2/e.size,a=r,n=.5*r,o=n-1;for(let l=0;l<6;l++){const g=this._FileFaces[l],L=e[g.name];let b=o;const p=e.format===5?4:3;for(let T=0;T<e.size;T++){let m=o;for(let P=0;P<e.size;P++){const O=g.worldAxisForFileX.scale(m).add(g.worldAxisForFileY.scale(b)).add(g.worldAxisForNormal);O.normalize();const c=this._AreaElement(m-n,b-n)-this._AreaElement(m-n,b+n)-this._AreaElement(m+n,b-n)+this._AreaElement(m+n,b+n);let R=L[T*e.size*p+P*p+0],_=L[T*e.size*p+P*p+1],E=L[T*e.size*p+P*p+2];isNaN(R)&&(R=0),isNaN(_)&&(_=0),isNaN(E)&&(E=0),e.type===0&&(R/=255,_/=255,E/=255),e.gammaSpace&&(R=Math.pow(C(R),x),_=Math.pow(C(_),x),E=Math.pow(C(E),x));const F=this.MAX_HDRI_VALUE;if(this.PRESERVE_CLAMPED_COLORS){const z=Math.max(R,_,E);if(z>F){const I=F/z;R*=I,_*=I,E*=I}}else R=C(R,0,F),_=C(_,0,F),E=C(E,0,F);const j=new k(R,_,E);t.addLight(O,j,c),s+=c,m+=r}b+=a}}const u=4*Math.PI*6/6/s;return t.scaleInPlace(u),t.convertIncidentRadianceToIrradiance(),t.convertIrradianceToLambertianRadiance(),B.FromHarmonics(t)}}D._FileFaces=[new w("right",new f(1,0,0),new f(0,0,-1),new f(0,-1,0)),new w("left",new f(-1,0,0),new f(0,0,1),new f(0,-1,0)),new w("up",new f(0,1,0),new f(1,0,0),new f(0,0,1)),new w("down",new f(0,-1,0),new f(1,0,0),new f(0,0,-1)),new w("front",new f(0,0,1),new f(1,0,0),new f(0,-1,0)),new w("back",new f(0,0,-1),new f(-1,0,0),new f(0,-1,0))];D.MAX_HDRI_VALUE=4096;D.PRESERVE_CLAMPED_COLORS=!1;class M{get renderList(){return this._renderList}set renderList(e){this._renderList!==e&&(this._unObserveRenderList&&(this._unObserveRenderList(),this._unObserveRenderList=null),e&&(this._unObserveRenderList=V(e,this._renderListHasChanged)),this._renderList=e)}get renderPassIds(){return this._renderPassIds}get currentRefreshId(){return this._currentRefreshId}setMaterialForRendering(e,t){let s;Array.isArray(e)?s=e:s=[e];for(let r=0;r<s.length;++r)for(let a=0;a<this.options.numPasses;++a)s[r].setMaterialForRenderPass(this._renderPassIds[a],t!==void 0?Array.isArray(t)?t[a]:t:void 0)}constructor(e,t,s){this._unObserveRenderList=null,this._renderListHasChanged=(r,a)=>{const n=this._renderList?this._renderList.length:0;(a===0&&n>0||n===0)&&this._scene.meshes.forEach(o=>{o._markSubMeshesAsLightDirty()})},this.particleSystemList=null,this.getCustomRenderList=null,this.renderParticles=!0,this.renderSprites=!1,this.forceLayerMaskCheck=!1,this.onBeforeRenderObservable=new S,this.onAfterRenderObservable=new S,this.onBeforeRenderingManagerRenderObservable=new S,this.onAfterRenderingManagerRenderObservable=new S,this.onFastPathRenderObservable=new S,this._currentRefreshId=-1,this._refreshRate=1,this._currentSceneCamera=null,this.name=e,this._scene=t,this.renderList=[],this._renderPassIds=[],this.options={numPasses:1,doNotChangeAspectRatio:!0,...s},this._createRenderPassId(),this.renderPassId=this._renderPassIds[0],this._renderingManager=new H(t),this._renderingManager._useSceneAutoClearSetup=!0}_releaseRenderPassId(){const e=this._scene.getEngine();for(let t=0;t<this.options.numPasses;++t)e.releaseRenderPassId(this._renderPassIds[t]);this._renderPassIds.length=0}_createRenderPassId(){this._releaseRenderPassId();const e=this._scene.getEngine();for(let t=0;t<this.options.numPasses;++t)this._renderPassIds[t]=e.createRenderPassId(`ObjectRenderer - ${this.name}#${t}`)}resetRefreshCounter(){this._currentRefreshId=-1}get refreshRate(){return this._refreshRate}set refreshRate(e){this._refreshRate=e,this.resetRefreshCounter()}shouldRender(){return this._currentRefreshId===-1?(this._currentRefreshId=1,!0):this.refreshRate===this._currentRefreshId?(this._currentRefreshId=1,!0):(this._currentRefreshId++,!1)}isReadyForRendering(e,t){this.prepareRenderList(),this.initRender(e,t);const s=this._checkReadiness();return this.finishRender(),s}prepareRenderList(){const e=this._scene;if(this._waitingRenderList){if(!this.renderListPredicate){this.renderList=[];for(let t=0;t<this._waitingRenderList.length;t++){const s=this._waitingRenderList[t],r=e.getMeshById(s);r&&this.renderList.push(r)}}this._waitingRenderList=void 0}if(this.renderListPredicate){this.renderList?this.renderList.length=0:this.renderList=[];const t=this._scene.meshes;for(let s=0;s<t.length;s++){const r=t[s];this.renderListPredicate(r)&&this.renderList.push(r)}}}initRender(e,t){const s=this._scene.getEngine(),r=this.activeCamera??this._scene.activeCamera;this._currentSceneCamera=this._scene.activeCamera,r&&(r!==this._scene.activeCamera&&(this._scene.setTransformMatrix(r.getViewMatrix(),r.getProjectionMatrix(!0)),this._scene.activeCamera=r),s.setViewport(r.rigParent?r.rigParent.viewport:r.viewport,e,t)),this._defaultRenderListPrepared=!1}finishRender(){const e=this._scene;e.activeCamera=this._currentSceneCamera,this._currentSceneCamera&&(this.activeCamera&&this.activeCamera!==e.activeCamera&&e.setTransformMatrix(this._currentSceneCamera.getViewMatrix(),this._currentSceneCamera.getProjectionMatrix(!0)),e.getEngine().setViewport(this._currentSceneCamera.viewport)),e.resetCachedMaterial()}render(e=0,t=!1){const s=this._scene,r=s.getEngine(),a=r.currentRenderPassId;if(r.currentRenderPassId=this._renderPassIds[e],this.onBeforeRenderObservable.notifyObservers(e),r.snapshotRendering&&r.snapshotRenderingMode===1)this.onFastPathRenderObservable.notifyObservers(e);else{let o=null;const d=this.renderList?this.renderList:s.getActiveMeshes().data,i=this.renderList?this.renderList.length:s.getActiveMeshes().length;this.getCustomRenderList&&(o=this.getCustomRenderList(e,d,i)),o?this._prepareRenderingManager(o,o.length,this.forceLayerMaskCheck):(this._defaultRenderListPrepared||(this._prepareRenderingManager(d,i,!this.renderList||this.forceLayerMaskCheck),this._defaultRenderListPrepared=!0),o=d),this.onBeforeRenderingManagerRenderObservable.notifyObservers(e),this._renderingManager.render(this.customRenderFunction,o,this.renderParticles,this.renderSprites),this.onAfterRenderingManagerRenderObservable.notifyObservers(e)}t||this.onAfterRenderObservable.notifyObservers(e),r.currentRenderPassId=a}_checkReadiness(){const e=this._scene,t=e.getEngine(),s=t.currentRenderPassId;let r=!0;e.getViewMatrix()||e.updateTransformMatrix();const a=this.options.numPasses;for(let o=0;o<a&&r;o++){let d=null;const i=this.renderList?this.renderList:e.getActiveMeshes().data,h=this.renderList?this.renderList.length:e.getActiveMeshes().length;t.currentRenderPassId=this._renderPassIds[o],this.onBeforeRenderObservable.notifyObservers(o),this.getCustomRenderList&&(d=this.getCustomRenderList(o,i,h)),d||(d=i),this._doNotChangeAspectRatio||e.updateTransformMatrix(!0);for(let u=0;u<d.length&&r;++u){const l=d[u];if(!(!l.isEnabled()||l.isBlocked||!l.isVisible||!l.subMeshes)){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(l,this.refreshRate,!0)){r=!1;continue}}else if(!l.isReady(!0)){r=!1;continue}}}this.onAfterRenderObservable.notifyObservers(o),a>1&&(e.incrementRenderId(),e.resetCachedMaterial())}const n=this.particleSystemList||e.particleSystems;for(const o of n)o.isReady()||(r=!1);return t.currentRenderPassId=s,r}_prepareRenderingManager(e,t,s){const r=this._scene,a=r.activeCamera;this._renderingManager.reset();const n=r.getRenderId();for(let d=0;d<t;d++){const i=e[d];if(i&&!i.isBlocked){if(this.customIsReadyFunction){if(!this.customIsReadyFunction(i,this.refreshRate,!1)){this.resetRefreshCounter();continue}}else if(!i.isReady(this.refreshRate===0)){this.resetRefreshCounter();continue}if(!i._internalAbstractMeshDataInfo._currentLODIsUpToDate&&a&&(i._internalAbstractMeshDataInfo._currentLOD=r.customLODSelector?r.customLODSelector(i,a):i.getLOD(a),i._internalAbstractMeshDataInfo._currentLODIsUpToDate=!0),!i._internalAbstractMeshDataInfo._currentLOD)continue;let h=i._internalAbstractMeshDataInfo._currentLOD;h!==i&&h.billboardMode!==0&&h.computeWorldMatrix(),h._preActivateForIntermediateRendering(n);let u;if(s&&a?u=(i.layerMask&a.layerMask)===0:u=!1,i.isEnabled()&&i.isVisible&&i.subMeshes&&!u){if(h!==i&&h._activate(n,!0),i._activate(n,!0)&&i.subMeshes.length){i.isAnInstance?i._internalAbstractMeshDataInfo._actAsRegularMesh&&(h=i):h._internalAbstractMeshDataInfo._onlyForInstancesIntermediate=!1,h._internalAbstractMeshDataInfo._isActiveIntermediate=!0,r._prepareSkeleton(h);for(let l=0;l<h.subMeshes.length;l++){const g=h.subMeshes[l];this._renderingManager.dispatch(g,h)}}i._postActivate()}}}const o=this.particleSystemList||r.particleSystems;for(let d=0;d<o.length;d++){const i=o[d],h=i.emitter;!i.isStarted()||!h||h.position&&!h.isEnabled()||this._renderingManager.dispatchParticles(i)}}setRenderingOrder(e,t=null,s=null,r=null){this._renderingManager.setRenderingOrder(e,t,s,r)}setRenderingAutoClearDepthStencil(e,t){this._renderingManager.setRenderingAutoClearDepthStencil(e,t),this._renderingManager._useSceneAutoClearSetup=!1}clone(){const e=new M(this.name,this._scene,this.options);return this.renderList&&(e.renderList=this.renderList.slice(0)),e}dispose(){const e=this.renderList?this.renderList:this._scene.getActiveMeshes().data,t=this.renderList?this.renderList.length:this._scene.getActiveMeshes().length;for(let s=0;s<t;s++){const r=e[s];r.getMaterialForRenderPass(this.renderPassId)!==void 0&&r.setMaterialForRenderPass(this.renderPassId,void 0)}this.onBeforeRenderObservable.clear(),this.onAfterRenderObservable.clear(),this.onBeforeRenderingManagerRenderObservable.clear(),this.onAfterRenderingManagerRenderObservable.clear(),this.onFastPathRenderObservable.clear(),this._releaseRenderPassId(),this.renderList=null}_rebuild(){this.refreshRate===M.REFRESHRATE_RENDER_ONCE&&(this.refreshRate=M.REFRESHRATE_RENDER_ONCE)}freeRenderingGroups(){this._renderingManager&&this._renderingManager.freeRenderingGroups()}}M.REFRESHRATE_RENDER_ONCE=0;M.REFRESHRATE_RENDER_ONEVERYFRAME=1;M.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=2;U.prototype.setDepthStencilTexture=function(A,e){this._engine.setDepthStencilTexture(this._samplers[A],this._uniforms[A],e,A)};class y extends v{get renderListPredicate(){return this._objectRenderer.renderListPredicate}set renderListPredicate(e){this._objectRenderer.renderListPredicate=e}get renderList(){return this._objectRenderer.renderList}set renderList(e){this._objectRenderer.renderList=e}get particleSystemList(){return this._objectRenderer.particleSystemList}set particleSystemList(e){this._objectRenderer.particleSystemList=e}get getCustomRenderList(){return this._objectRenderer.getCustomRenderList}set getCustomRenderList(e){this._objectRenderer.getCustomRenderList=e}get renderParticles(){return this._objectRenderer.renderParticles}set renderParticles(e){this._objectRenderer.renderParticles=e}get renderSprites(){return this._objectRenderer.renderSprites}set renderSprites(e){this._objectRenderer.renderSprites=e}get forceLayerMaskCheck(){return this._objectRenderer.forceLayerMaskCheck}set forceLayerMaskCheck(e){this._objectRenderer.forceLayerMaskCheck=e}get activeCamera(){return this._objectRenderer.activeCamera}set activeCamera(e){this._objectRenderer.activeCamera=e}get customIsReadyFunction(){return this._objectRenderer.customIsReadyFunction}set customIsReadyFunction(e){this._objectRenderer.customIsReadyFunction=e}get customRenderFunction(){return this._objectRenderer.customRenderFunction}set customRenderFunction(e){this._objectRenderer.customRenderFunction=e}get postProcesses(){return this._postProcesses}get _prePassEnabled(){return!!this._prePassRenderTarget&&this._prePassRenderTarget.enabled}set onAfterUnbind(e){this._onAfterUnbindObserver&&this.onAfterUnbindObservable.remove(this._onAfterUnbindObserver),this._onAfterUnbindObserver=this.onAfterUnbindObservable.add(e)}get onBeforeRenderObservable(){return this._objectRenderer.onBeforeRenderObservable}set onBeforeRender(e){this._onBeforeRenderObserver&&this.onBeforeRenderObservable.remove(this._onBeforeRenderObserver),this._onBeforeRenderObserver=this.onBeforeRenderObservable.add(e)}get onAfterRenderObservable(){return this._objectRenderer.onAfterRenderObservable}set onAfterRender(e){this._onAfterRenderObserver&&this.onAfterRenderObservable.remove(this._onAfterRenderObserver),this._onAfterRenderObserver=this.onAfterRenderObservable.add(e)}set onClear(e){this._onClearObserver&&this.onClearObservable.remove(this._onClearObserver),this._onClearObserver=this.onClearObservable.add(e)}get _waitingRenderList(){return this._objectRenderer._waitingRenderList}set _waitingRenderList(e){this._objectRenderer._waitingRenderList=e}get renderPassId(){return this._objectRenderer.renderPassId}get renderPassIds(){return this._objectRenderer.renderPassIds}get currentRefreshId(){return this._objectRenderer.currentRefreshId}setMaterialForRendering(e,t){this._objectRenderer.setMaterialForRendering(e,t)}get isMulti(){var e;return((e=this._renderTarget)==null?void 0:e.isMulti)??!1}get renderTargetOptions(){return this._renderTargetOptions}get renderTarget(){return this._renderTarget}_onRatioRescale(){this._sizeRatio&&this.resize(this._initialSizeParameter)}set boundingBoxSize(e){if(this._boundingBoxSize&&this._boundingBoxSize.equals(e))return;this._boundingBoxSize=e;const t=this.getScene();t&&t.markAllMaterialsAsDirty(1)}get boundingBoxSize(){return this._boundingBoxSize}get depthStencilTexture(){var e;return((e=this._renderTarget)==null?void 0:e._depthStencilTexture)??null}constructor(e,t,s,r=!1,a=!0,n=0,o=!1,d=v.TRILINEAR_SAMPLINGMODE,i=!0,h=!1,u=!1,l=5,g=!1,L,b,p=!1,T=!1){let m,P=!0;if(typeof r=="object"){const c=r;r=!!c.generateMipMaps,a=c.doNotChangeAspectRatio??!0,n=c.type??0,o=!!c.isCube,d=c.samplingMode??v.TRILINEAR_SAMPLINGMODE,i=c.generateDepthBuffer??!0,h=!!c.generateStencilBuffer,u=!!c.isMulti,l=c.format??5,g=!!c.delayAllocation,L=c.samples,b=c.creationFlags,p=!!c.noColorAttachment,T=!!c.useSRGBBuffer,m=c.colorAttachment,P=c.gammaSpace??P}if(super(null,s,!r,void 0,d,void 0,void 0,void 0,void 0,l),this.ignoreCameraViewport=!1,this.onBeforeBindObservable=new S,this.onAfterUnbindObservable=new S,this.onClearObservable=new S,this.onResizeObservable=new S,this._cleared=!1,this.skipInitialClear=!1,this._samples=1,this._canRescale=!0,this._renderTarget=null,this.boundingBoxPosition=f.Zero(),this._disableEngineStages=!1,this._dumpToolsLoading=!1,s=this.getScene(),!s)return;const O=this.getScene().getEngine();this._gammaSpace=P,this._coordinatesMode=v.PROJECTION_MODE,this.name=e,this.isRenderTarget=!0,this._initialSizeParameter=t,this._processSizeParameter(t),this._objectRenderer=new M(e,s,{numPasses:o?6:this.getRenderLayers()||1,doNotChangeAspectRatio:a}),this._objectRenderer.onBeforeRenderingManagerRenderObservable.add(()=>{if(!this._disableEngineStages)for(const c of this._scene._beforeRenderTargetClearStage)c.action(this,this._currentFaceIndex,this._currentLayer);if(this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(O):this.skipInitialClear||O.clear(this.clearColor||this._scene.clearColor,!0,!0,!0),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),!this._disableEngineStages)for(const c of this._scene._beforeRenderTargetDrawStage)c.action(this,this._currentFaceIndex,this._currentLayer)}),this._objectRenderer.onAfterRenderingManagerRenderObservable.add(()=>{var R;if(!this._disableEngineStages)for(const _ of this._scene._afterRenderTargetDrawStage)_.action(this,this._currentFaceIndex,this._currentLayer);const c=((R=this._texture)==null?void 0:R.generateMipMaps)??!1;if(this._texture&&(this._texture.generateMipMaps=!1),this._postProcessManager?this._postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex,this._postProcesses,this.ignoreCameraViewport):this._currentUseCameraPostProcess&&this._scene.postProcessManager._finalizeFrame(!1,this._renderTarget??void 0,this._currentFaceIndex),!this._disableEngineStages)for(const _ of this._scene._afterRenderTargetPostProcessStage)_.action(this,this._currentFaceIndex,this._currentLayer);this._texture&&(this._texture.generateMipMaps=c),this._doNotChangeAspectRatio||this._scene.updateTransformMatrix(!0),this._currentDumpForDebug&&(this._dumpTools?this._dumpTools.DumpFramebuffer(this.getRenderWidth(),this.getRenderHeight(),O):G.Error("dumpTools module is still being loaded. To speed up the process import dump tools directly in your project"))}),this._objectRenderer.onFastPathRenderObservable.add(()=>{this.onClearObservable.hasObservers()?this.onClearObservable.notifyObservers(O):this.skipInitialClear||O.clear(this.clearColor||this._scene.clearColor,!0,!0,!0)}),this._resizeObserver=O.onResizeObservable.add(()=>{}),this._generateMipMaps=!!r,this._doNotChangeAspectRatio=a,!u&&(this._renderTargetOptions={generateMipMaps:r,type:n,format:this._format??void 0,samplingMode:this.samplingMode,generateDepthBuffer:i,generateStencilBuffer:h,samples:L,creationFlags:b,noColorAttachment:p,useSRGBBuffer:T,colorAttachment:m,label:this.name},this.samplingMode===v.NEAREST_SAMPLINGMODE&&(this.wrapU=v.CLAMP_ADDRESSMODE,this.wrapV=v.CLAMP_ADDRESSMODE),g||(o?(this._renderTarget=s.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions),this.coordinatesMode=v.INVCUBIC_MODE,this._textureMatrix=W.Identity()):this._renderTarget=s.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,L!==void 0&&(this.samples=L)))}createDepthStencilTexture(e=0,t=!0,s=!1,r=1,a=14,n){var o;(o=this._renderTarget)==null||o.createDepthStencilTexture(e,t,s,r,a,n)}_processSizeParameter(e){if(e.ratio){this._sizeRatio=e.ratio;const t=this._getEngine();this._size={width:this._bestReflectionRenderTargetDimension(t.getRenderWidth(),this._sizeRatio),height:this._bestReflectionRenderTargetDimension(t.getRenderHeight(),this._sizeRatio)}}else this._size=e}get samples(){var e;return((e=this._renderTarget)==null?void 0:e.samples)??this._samples}set samples(e){this._renderTarget&&(this._samples=this._renderTarget.setSamples(e))}addPostProcess(e){if(!this._postProcessManager){const t=this.getScene();if(!t)return;this._postProcessManager=new Y(t),this._postProcesses=new Array}this._postProcesses.push(e),this._postProcesses[0].autoClear=!1}clearPostProcesses(e=!1){if(this._postProcesses){if(e)for(const t of this._postProcesses)t.dispose();this._postProcesses=[]}}removePostProcess(e){if(!this._postProcesses)return;const t=this._postProcesses.indexOf(e);t!==-1&&(this._postProcesses.splice(t,1),this._postProcesses.length>0&&(this._postProcesses[0].autoClear=!1))}resetRefreshCounter(){this._objectRenderer.resetRefreshCounter()}get refreshRate(){return this._objectRenderer.refreshRate}set refreshRate(e){this._objectRenderer.refreshRate=e}_shouldRender(){return this._objectRenderer.shouldRender()}getRenderSize(){return this.getRenderWidth()}getRenderWidth(){return this._size.width?this._size.width:this._size}getRenderHeight(){return this._size.width?this._size.height:this._size}getRenderLayers(){const e=this._size.layers;if(e)return e;const t=this._size.depth;return t||0}disableRescaling(){this._canRescale=!1}get canRescale(){return this._canRescale}scale(e){const t=Math.max(1,this.getRenderSize()*e);this.resize(t)}getReflectionTextureMatrix(){return this.isCube?this._textureMatrix:super.getReflectionTextureMatrix()}resize(e){var r;const t=this.isCube;(r=this._renderTarget)==null||r.dispose(),this._renderTarget=null;const s=this.getScene();s&&(this._processSizeParameter(e),t?this._renderTarget=s.getEngine().createRenderTargetCubeTexture(this.getRenderSize(),this._renderTargetOptions):this._renderTarget=s.getEngine().createRenderTargetTexture(this._size,this._renderTargetOptions),this._texture=this._renderTarget.texture,this._renderTargetOptions.samples!==void 0&&(this.samples=this._renderTargetOptions.samples),this.onResizeObservable.hasObservers()&&this.onResizeObservable.notifyObservers(this))}render(e=!1,t=!1){this._render(e,t)}isReadyForRendering(){this._dumpToolsLoading||(this._dumpToolsLoading=!0,q(()=>import("./dumpTools-D8pWAxiB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7]),import.meta.url).then(t=>this._dumpTools=t)),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight());const e=this._objectRenderer._checkReadiness();return this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender(),e}_render(e=!1,t=!1){const s=this.getScene();if(s){if(this.useCameraPostProcesses!==void 0&&(e=this.useCameraPostProcesses),this._objectRenderer.prepareRenderList(),this.onBeforeBindObservable.notifyObservers(this),this._objectRenderer.initRender(this.getRenderWidth(),this.getRenderHeight()),(this.is2DArray||this.is3D)&&!this.isMulti)for(let r=0;r<this.getRenderLayers();r++)this._renderToTarget(0,e,t,r),s.incrementRenderId(),s.resetCachedMaterial();else if(this.isCube&&!this.isMulti)for(let r=0;r<6;r++)this._renderToTarget(r,e,t),s.incrementRenderId(),s.resetCachedMaterial();else this._renderToTarget(0,e,t);this.onAfterUnbindObservable.notifyObservers(this),this._objectRenderer.finishRender()}}_bestReflectionRenderTargetDimension(e,t){const r=e*t,a=X(r+128*128/(128+r));return Math.min($(e),a)}_bindFrameBuffer(e=0,t=0){const s=this.getScene();if(!s)return;const r=s.getEngine();this._renderTarget&&r.bindFramebuffer(this._renderTarget,this.isCube?e:void 0,void 0,void 0,this.ignoreCameraViewport,0,t)}_unbindFrameBuffer(e,t){this._renderTarget&&e.unBindFramebuffer(this._renderTarget,this.isCube,()=>{this.onAfterRenderObservable.notifyObservers(t)})}_prepareFrame(e,t,s,r){this._postProcessManager?this._prePassEnabled||this._postProcessManager._prepareFrame(this._texture,this._postProcesses):(!r||!e.postProcessManager._prepareFrame(this._texture))&&this._bindFrameBuffer(t,s)}_renderToTarget(e,t,s,r=0){var o,d;const a=this.getScene();if(!a)return;const n=a.getEngine();this._currentFaceIndex=e,this._currentLayer=r,this._currentUseCameraPostProcess=t,this._currentDumpForDebug=s,this._prepareFrame(a,e,r,t),(o=n._debugPushGroup)==null||o.call(n,`render to face #${e} layer #${r}`,2),this._objectRenderer.render(e+r,!0),(d=n._debugPopGroup)==null||d.call(n,2),this._unbindFrameBuffer(n,e),this._texture&&this.isCube&&e===5&&n.generateMipMapsForCubemap(this._texture,!0)}setRenderingOrder(e,t=null,s=null,r=null){this._objectRenderer.setRenderingOrder(e,t,s,r)}setRenderingAutoClearDepthStencil(e,t){this._objectRenderer.setRenderingAutoClearDepthStencil(e,t)}clone(){const e=this.getSize(),t=new y(this.name,e,this.getScene(),this._renderTargetOptions.generateMipMaps,this._doNotChangeAspectRatio,this._renderTargetOptions.type,this.isCube,this._renderTargetOptions.samplingMode,this._renderTargetOptions.generateDepthBuffer,this._renderTargetOptions.generateStencilBuffer,void 0,this._renderTargetOptions.format,void 0,this._renderTargetOptions.samples);return t.hasAlpha=this.hasAlpha,t.level=this.level,t.coordinatesMode=this.coordinatesMode,this.renderList&&(t.renderList=this.renderList.slice(0)),t}serialize(){if(!this.name)return null;const e=super.serialize();if(e.renderTargetSize=this.getRenderSize(),e.renderList=[],this.renderList)for(let t=0;t<this.renderList.length;t++)e.renderList.push(this.renderList[t].id);return e}disposeFramebufferObjects(){var e;(e=this._renderTarget)==null||e.dispose(!0)}releaseInternalTexture(){var e;(e=this._renderTarget)==null||e.releaseTextures(),this._texture=null}dispose(){var s;this.onResizeObservable.clear(),this.onClearObservable.clear(),this.onAfterUnbindObservable.clear(),this.onBeforeBindObservable.clear(),this._postProcessManager&&(this._postProcessManager.dispose(),this._postProcessManager=null),this._prePassRenderTarget&&this._prePassRenderTarget.dispose(),this._objectRenderer.dispose(),this.clearPostProcesses(!0),this._resizeObserver&&(this.getScene().getEngine().onResizeObservable.remove(this._resizeObserver),this._resizeObserver=null);const e=this.getScene();if(!e)return;let t=e.customRenderTargets.indexOf(this);t>=0&&e.customRenderTargets.splice(t,1);for(const r of e.cameras)t=r.customRenderTargets.indexOf(this),t>=0&&r.customRenderTargets.splice(t,1);(s=this._renderTarget)==null||s.dispose(),this._renderTarget=null,this._texture=null,super.dispose()}_rebuild(){this._objectRenderer._rebuild(),this._postProcessManager&&this._postProcessManager._rebuild()}freeRenderingGroups(){this._objectRenderer.freeRenderingGroups()}getViewCount(){return 1}}y.REFRESHRATE_RENDER_ONCE=M.REFRESHRATE_RENDER_ONCE;y.REFRESHRATE_RENDER_ONEVERYFRAME=M.REFRESHRATE_RENDER_ONEVERYFRAME;y.REFRESHRATE_RENDER_ONEVERYTWOFRAMES=M.REFRESHRATE_RENDER_ONEVERYTWOFRAMES;v._CreateRenderTargetTexture=(A,e,t,s,r)=>new y(A,e,t,s);export{D as C};
