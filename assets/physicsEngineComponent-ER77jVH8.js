import{W as u,V as r,y as h,X as a,p as _,Y as p,Z as o}from"./create-runtime-stories-DyAm3Txo.js";import"./props-CDwtXEPn.js";import"./index-client-0IVJ1HVs.js";import"./iframe-CEReE_Su.js";import"../sb-preview/runtime.js";import"./index-D-8MO0q_.js";import"./index-BHYIh-Xd.js";import"./_commonjsHelpers-Cpj98o6Y.js";let g=class l{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw u("CannonJSPlugin")}constructor(s,i=l.DefaultPluginFactory()){if(this._physicsPlugin=i,this._impostors=[],this._joints=[],this._subTimeStep=0,this._uniqueIdCounter=0,!this._physicsPlugin.isSupported())throw new Error("Physics Engine "+this._physicsPlugin.name+" cannot be found. Please make sure it is included.");s=s||new r(0,-9.807,0),this.setGravity(s),this.setTimeStep()}setGravity(s){this.gravity=s,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(s=1/60){this._physicsPlugin.setTimeStep(s)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(s=0){this._subTimeStep=s}getSubTimeStep(){return this._subTimeStep}dispose(){this._impostors.forEach(function(s){s.dispose()}),this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}addImpostor(s){this._impostors.push(s),s.uniqueId=this._uniqueIdCounter++,s.parent||this._physicsPlugin.generatePhysicsBody(s)}removeImpostor(s){const i=this._impostors.indexOf(s);i>-1&&this._impostors.splice(i,1).length&&this.getPhysicsPlugin().removePhysicsBody(s)}addJoint(s,i,e){const n={mainImpostor:s,connectedImpostor:i,joint:e};e.physicsPlugin=this._physicsPlugin,this._joints.push(n),this._physicsPlugin.generateJoint(n)}removeJoint(s,i,e){const n=this._joints.filter(function(c){return c.connectedImpostor===i&&c.joint===e&&c.mainImpostor===s});n.length&&this._physicsPlugin.removeJoint(n[0])}_step(s){this._impostors.forEach(i=>{i.isBodyInitRequired()&&this._physicsPlugin.generatePhysicsBody(i)}),s>.1?s=.1:s<=0&&(s=1/60),this._physicsPlugin.executeStep(s,this._impostors)}getPhysicsPlugin(){return this._physicsPlugin}getImpostors(){return this._impostors}getImpostorForPhysicsObject(s){for(let i=0;i<this._impostors.length;++i)if(this._impostors[i].object===s)return this._impostors[i];return null}getImpostorWithPhysicsBody(s){for(let i=0;i<this._impostors.length;++i)if(this._impostors[i].physicsBody===s)return this._impostors[i];return null}raycast(s,i){return this._physicsPlugin.raycast(s,i)}raycastToRef(s,i,e){return this._physicsPlugin.raycastToRef(s,i,e)}};class m{constructor(){this._hasHit=!1,this._hitNormal=r.Zero(),this._hitPoint=r.Zero(),this._triangleIndex=-1}get hitPoint(){return this._hitPoint}get hitNormal(){return this._hitNormal}get hasHit(){return this._hasHit}get triangleIndex(){return this._triangleIndex}setHitData(s,i,e){this._hasHit=!0,this._hitNormal.set(s.x,s.y,s.z),this._hitPoint.set(i.x,i.y,i.z),this._triangleIndex=e??-1}reset(){this._hasHit=!1,this._hitNormal.setAll(0),this._hitPoint.setAll(0),this._triangleIndex=-1,this.body=void 0,this.bodyIndex=void 0,this.shape=void 0}}class d extends m{constructor(){super(...arguments),this._hitDistance=0,this._rayFromWorld=r.Zero(),this._rayToWorld=r.Zero()}get hitDistance(){return this._hitDistance}get hitNormalWorld(){return this._hitNormal}get hitPointWorld(){return this._hitPoint}get rayFromWorld(){return this._rayFromWorld}get rayToWorld(){return this._rayToWorld}setHitDistance(s){this._hitDistance=s}calculateHitDistance(){this._hitDistance=r.Distance(this._rayFromWorld,this._hitPoint)}reset(s=r.Zero(),i=r.Zero()){super.reset(),this._rayFromWorld.copyFrom(s),this._rayToWorld.copyFrom(i),this._hitDistance=0}}class y{getPluginVersion(){return this._physicsPlugin.getPluginVersion()}static DefaultPluginFactory(){throw u("")}constructor(s,i=y.DefaultPluginFactory()){this._physicsPlugin=i,this._physicsBodies=[],this._subTimeStep=0,s=s||new r(0,-9.807,0),this.setGravity(s),this.setTimeStep()}setGravity(s){this.gravity=s,this._physicsPlugin.setGravity(this.gravity)}setTimeStep(s=1/60){this._physicsPlugin.setTimeStep(s)}getTimeStep(){return this._physicsPlugin.getTimeStep()}setSubTimeStep(s=0){this._subTimeStep=s}getSubTimeStep(){return this._subTimeStep}dispose(){this._physicsPlugin.dispose()}getPhysicsPluginName(){return this._physicsPlugin.name}setVelocityLimits(s,i){this._physicsPlugin.setVelocityLimits(s,i)}getMaxLinearVelocity(){return this._physicsPlugin.getMaxLinearVelocity()}getMaxAngularVelocity(){return this._physicsPlugin.getMaxAngularVelocity()}_step(s){s>.1?s=.1:s<=0&&(s=1/60),this._physicsPlugin.executeStep(s,this._physicsBodies)}addBody(s){this._physicsBodies.push(s)}removeBody(s){const i=this._physicsBodies.indexOf(s);i>-1&&this._physicsBodies.splice(i,1)}getBodies(){return this._physicsBodies}getPhysicsPlugin(){return this._physicsPlugin}raycastToRef(s,i,e,n){this._physicsPlugin.raycast(s,i,e,n)}raycast(s,i,e){const n=new d;return this._physicsPlugin.raycast(s,i,n,e),n}}h.prototype.getPhysicsEngine=function(){return this._physicsEngine};h.prototype.enablePhysics=function(t=null,s){if(this._physicsEngine)return!0;let i=this._getComponent(a.NAME_PHYSICSENGINE);i||(i=new P(this),this._addComponent(i));try{if(!s||(s==null?void 0:s.getPluginVersion())===1)this._physicsEngine=new g(t,s);else if((s==null?void 0:s.getPluginVersion())===2)this._physicsEngine=new y(t,s);else throw new Error("Unsupported Physics plugin version.");return this._physicsTimeAccumulator=0,!0}catch(e){return _.Error(e.message),!1}};h.prototype.disablePhysicsEngine=function(){this._physicsEngine&&(this._physicsEngine.dispose(),this._physicsEngine=null)};h.prototype.isPhysicsEnabled=function(){return this._physicsEngine!==void 0};h.prototype.deleteCompoundImpostor=function(t){const s=t.parts[0].mesh;s.physicsImpostor&&(s.physicsImpostor.dispose(),s.physicsImpostor=null)};h.prototype._advancePhysicsEngineStep=function(t){if(this._physicsEngine){const s=this._physicsEngine.getSubTimeStep();if(s>0)for(this._physicsTimeAccumulator+=t;this._physicsTimeAccumulator>s;)this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(s/1e3),this.onAfterPhysicsObservable.notifyObservers(this),this._physicsTimeAccumulator-=s;else this.onBeforePhysicsObservable.notifyObservers(this),this._physicsEngine._step(t/1e3),this.onAfterPhysicsObservable.notifyObservers(this)}};class P{constructor(s){this.name=a.NAME_PHYSICSENGINE,this.scene=s,this.scene.onBeforePhysicsObservable=new p,this.scene.onAfterPhysicsObservable=new p,this.scene.getDeterministicFrameTime=()=>this.scene._physicsEngine?this.scene._physicsEngine.getTimeStep()*1e3:1e3/60}register(){}rebuild(){}dispose(){this.scene.onBeforePhysicsObservable.clear(),this.scene.onAfterPhysicsObservable.clear(),this.scene._physicsEngine&&this.scene.disablePhysicsEngine()}}Object.defineProperty(o.prototype,"physicsBody",{get:function(){return this._physicsBody},set:function(t){this._physicsBody!==t&&(this._disposePhysicsObserver&&this.onDisposeObservable.remove(this._disposePhysicsObserver),this._physicsBody=t,t&&(this._disposePhysicsObserver=this.onDisposeObservable.add(()=>{this.physicsBody&&(this.physicsBody.dispose(),this.physicsBody=null)})))},enumerable:!0,configurable:!0});o.prototype.getPhysicsBody=function(){return this.physicsBody};o.prototype.applyImpulse=function(t,s){if(!this.physicsBody)throw new Error("No Physics Body for TransformNode");return this.physicsBody.applyImpulse(t,s),this};o.prototype.applyAngularImpulse=function(t){if(!this.physicsBody)throw new Error("No Physics Body for TransformNode");return this.physicsBody.applyAngularImpulse(t),this};
